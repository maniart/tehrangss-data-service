<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="./bower_components/normalize-css/normalize.css">
	<script type="text/javascript" src="./bower_components/jquery/dist/jquery.min.js"></script>
	<title>Emotion Tracker</title>
</head>
<body>
	

	<p><button onclick="geoFindMe()">Show my location</button></p>
	
	<div id="out"></div>

	<form id="image-upload" method="post" >
		<input type="file" id="image-field" name="image-field" accept="image/*">
		<button type="submit">Upload</button>	
	</form>
	

	<script type="text/javascript">
		window.__location  =  {
			lon: 0.0,
			lat: 0.0
		};

		var $form = $('#image-upload');
		$(document).ready(function() {
		
			$form.on('submit', function(e) {
				// console.log();
				e.preventDefault();
				e.stopPropagation();
				

				$.ajax({
					url: '/api/submit',
					type: 'POST',
					beforeSend: function(xhrObj){
			      // Request headers
			      xhrObj.setRequestHeader('Content-Type','application/json');
			    },
					data: JSON.stringify(window.__location),
					cache: false,
	        contentType: false,
	        processData: false
				}).done(function() {
					console.log('done ', arguments);
				}).fail(function(e) {
					console.log('fail', e);
				}).always(function() {
					console.log('always');
					// window.__location = {};
				});
			});

			function geoFindMe() {
			  var output = document.getElementById("out");

			  if (!navigator.geolocation){
			    output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
			    return;
			  }

			  function success(position) {
			    console.log(position);
			    window.__location.lon = position.coords.longitude;
			    window.__location.lat = position.coords.latitude;
			    
			    output.innerHTML = '<p>Latitude is ' + window.__location.lat + '° <br>Longitude is ' + window.__location.lon + '°</p>';

			  }

			  function error() {
			    output.innerHTML = "Unable to retrieve your location";
			  }

				  output.innerHTML = "<p>Locating…</p>";

				  navigator.geolocation.getCurrentPosition(success, error);
			}

			geoFindMe();
		});
		
	</script>
</body>
</html>